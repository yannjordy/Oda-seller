<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Param√®tres - Ma Boutique √âl√©gante</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="oda.jpg">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="styles-param.css">
    <script src="/notifications.js"></script>
    <link rel="manifest" href="manifest.json">
</head>
<style>
    /* ==================== VARIABLES ==================== */
:root {
    --primary-color: #007AFF;
    --secondary-color: #5856D6;
    --success-color: #34C759;
    --warning-color: #FF9500;
    --danger-color: #FF3B30;
    --bg-primary: #F5F5F7;
    --bg-secondary: #FFFFFF;
    --text-primary: #1D1D1F;
    --text-secondary: #6E6E73;
    --border-color: #D2D2D7;
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
}

/* ==================== HEADER ==================== */
.main-header {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-sm);
}

.header-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
}

.hamburger-btn {
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 6px;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.hamburger-btn:hover {
    background: var(--bg-primary);
}

.hamburger-btn span {
    width: 100%;
    height: 2px;
    background: var(--text-primary);
    border-radius: 2px;
    transition: all 0.3s ease;
}

.hamburger-btn.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
}

.hamburger-btn.active span:nth-child(2) {
    opacity: 0;
}

.hamburger-btn.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
}

.brand-section {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo-image {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    border-radius: 10px;
    box-shadow: var(--shadow-sm);
}

.brand-name {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 16px;
}

.icon-btn {
    position: relative;
    width: 40px;
    height: 40px;
    background: var(--bg-primary);
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.icon-btn:hover {
    background: var(--border-color);
    transform: translateY(-2px);
}

.badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--danger-color);
    color: white;
    font-size: 0.7rem;
    font-weight: 600;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 12px 6px 6px;
    background: var(--bg-primary);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.user-profile:hover {
    background: var(--border-color);
}

.avatar-image {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--success-color), var(--primary-color));
    border-radius: 50%;
}

.user-name {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-primary);
}
/* Cacher le menu hamburger en mode mobile */
@media (max-width: 768px) {
    .hamburger-btn {
        display: none !important;
    }
    
    .settings-sidebar {
        display: none !important;
    }
    
    .settings-container {
        grid-template-columns: 1fr !important;
        padding-bottom: 100px !important;
    }
    
    .brand-section .brand-name {
        font-size: 0.9rem;
    }
    
    .header-container {
        padding: 10px 12px;
    }
}
/* ==================== MENU HAMBURGER ==================== */
.hamburger-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: 1998;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.hamburger-overlay.active {
    opacity: 1;
    visibility: visible;
}

.hamburger-menu {
    position: fixed;
    top: 0;
    left: -320px;
    width: 280px;
    height: 100vh;
    height: 100dvh;
    background: var(--bg-secondary);
    box-shadow: var(--shadow-lg);
    z-index: 1999;
    transition: left 0.3s ease;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
}

.hamburger-menu.active {
    left: 0;
}

.hamburger-header {
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.close-menu {
    width: 36px;
    height: 36px;
    background: var(--bg-primary);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.close-menu:hover {
    background: var(--border-color);
    transform: rotate(90deg);
}

.hamburger-nav {
    flex: 1;
    padding: 16px;
}

.hamburger-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    margin-bottom: 4px;
    text-decoration: none;
    color: var(--text-primary);
    border-radius: 10px;
    transition: all 0.3s ease;
    font-weight: 500;
    background: none;
    border: none;
    width: 100%;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-size: 0.95rem;
}

.hamburger-link:hover {
    background: var(--bg-primary);
    transform: translateX(4px);
}

.hamburger-link.active {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
}

.link-icon {
    font-size: 1.25rem;
}

.hamburger-divider {
    height: 1px;
    background: var(--border-color);
    margin: 12px 0;
}

.hamburger-footer {
    padding: 16px;
    border-top: 1px solid var(--border-color);
}

/* ==================== CONTAINER ==================== */
.settings-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 32px 24px;
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 32px;
}

/* ==================== SIDEBAR ==================== */
.settings-sidebar {
    background: var(--bg-secondary);
    padding: 24px;
    border-radius: 16px;
    box-shadow: var(--shadow-sm);
    height: fit-content;
    position: sticky;
    top: 100px;
}

.settings-menu {
    list-style: none;
}

.settings-menu-item {
    margin-bottom: 4px;
}

.settings-menu-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 10px;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.3s ease;
    font-weight: 500;
    font-size: 0.95rem;
}

.settings-menu-link:hover {
    background: var(--bg-primary);
    color: var(--primary-color);
}

.settings-menu-link.active {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
}

.settings-icon {
    font-size: 1.2rem;
}

/* ==================== CONTENT ==================== */
.settings-content {
    min-height: 500px;
}

.settings-section {
    background: var(--bg-secondary);
    padding: 32px;
    border-radius: 16px;
    box-shadow: var(--shadow-sm);
    animation: fadeIn 0.4s ease;
}

.section-header {
    margin-bottom: 32px;
    padding-bottom: 16px;
    border-bottom: 2px solid var(--bg-primary);
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.section-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* ==================== FORMULAIRES ==================== */
.form-group {
    margin-bottom: 24px;
}

.form-label {
    display: block;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 8px;
    font-size: 0.95rem;
}

.form-input,
.form-textarea,
.form-select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    font-family: 'Poppins', sans-serif;
    font-size: 0.95rem;
    color: var(--text-primary);
    background: var(--bg-secondary);
    transition: all 0.3s ease;
}

.form-input:focus,
.form-textarea:focus,
.form-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

.form-textarea {
    resize: vertical;
    min-height: 100px;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.form-hint {
    display: block;
    margin-top: 4px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* ==================== BOUTONS ==================== */
.btn-primary,
.btn-secondary,
.btn-danger,
.btn-confirm {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-family: 'Poppins', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    box-shadow: var(--shadow-sm);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.btn-confirm {
    background: var(--success-color);
    color: white;
    margin-top: 8px;
}

.btn-confirm:hover {
    background: #2eae48;
}

.btn-danger {
    background: var(--danger-color);
    color: white;
}

.btn-danger:hover {
    background: #d32f2f;
}

/* ==================== TOGGLE SWITCH ==================== */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 52px;
    height: 28px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--border-color);
    transition: 0.3s;
    border-radius: 28px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
}

input:checked + .toggle-slider:before {
    transform: translateX(24px);
}

/* ==================== SETTING ITEMS ==================== */
.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: var(--bg-primary);
    border-radius: 12px;
    margin-bottom: 12px;
}

.setting-info h4 {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.setting-info p {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* ==================== PAIEMENT ==================== */
.payment-methods {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.payment-card {
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
}

.payment-card:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.payment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.payment-info {
    display: flex;
    align-items: center;
    gap: 16px;
}

.payment-icon {
    font-size: 2rem;
}

.payment-info h4 {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.payment-info p {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.payment-details {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border-color);
}

.info-text {
    color: var(--success-color);
    font-weight: 500;
    padding: 8px 0;
}

/* ==================== IDENTIFIANT ==================== */
.input-with-prefix {
    display: flex;
    align-items: center;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.input-with-prefix:focus-within {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

.input-prefix {
    background: var(--bg-primary);
    padding: 12px 16px;
    font-weight: 600;
    color: var(--text-secondary);
}

.input-with-prefix .form-input {
    border: none;
    box-shadow: none;
}

.slug-status {
    margin-top: 8px;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 500;
}

.slug-status.available {
    background: rgba(52, 199, 89, 0.1);
    color: var(--success-color);
}

.slug-status.unavailable {
    background: rgba(255, 59, 48, 0.1);
    color: var(--danger-color);
}

.preview-url {
    margin-top: 16px;
    padding: 16px;
    background: var(--bg-primary);
    border-radius: 10px;
}

.url-preview {
    margin-top: 8px;
    font-family: monospace;
    font-size: 1rem;
    color: var(--primary-color);
}

.alert-info {
    display: flex;
    gap: 12px;
    padding: 16px;
    background: rgba(0, 122, 255, 0.1);
    border-left: 4px solid var(--primary-color);
    border-radius: 10px;
    margin-bottom: 24px;
}

.alert-icon {
    font-size: 1.5rem;
}

/* ==================== DANGER ZONE ==================== */
.danger-zone {
    margin-top: 32px;
    padding-top: 32px;
    border-top: 2px solid var(--bg-primary);
}

.danger-zone h4 {
    color: var(--danger-color);
    margin-bottom: 8px;
    font-weight: 600;
}

.danger-zone p {
    color: var(--text-secondary);
    margin-bottom: 16px;
    font-size: 0.9rem;
}

.danger-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

/* ==================== ANIMATIONS ==================== */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.color-picker {
    width: 60px;
    height: 40px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
}

.preset-btn:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.upload-area:hover {
    border-color: var(--primary-color);
    background: rgba(0, 122, 255, 0.05);
}

.preview-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.preview-btn-secondary:hover {
    background: var(--primary-color);
    color: white;
}

.appearance-group {
    margin-bottom: 32px;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
}
/* ==================== MOBILE MONEY STYLES ==================== */

.mobile-money-section {
    margin-bottom: 20px;
    padding: 16px;
    background: var(--bg-primary);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.mobile-money-section:hover {
    background: #F0F0F2;
}

.mobile-money-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.mobile-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.mobile-money-header h5 {
    flex: 1;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

/* Toggle Switch Small */
.toggle-switch-small {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
}

.toggle-switch-small input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider-small {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--border-color);
    transition: 0.3s;
    border-radius: 24px;
}

.toggle-slider-small:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

input:checked + .toggle-slider-small {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
}

input:checked + .toggle-slider-small:before {
    transform: translateX(20px);
}

/* Inputs Mobile Money */
.mobile-money-inputs {
    margin-top: 16px;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.mobile-money-inputs .form-group {
    margin-bottom: 16px;
}

.mobile-money-inputs .form-group:last-child {
    margin-bottom: 0;
}

.mobile-divider {
    height: 1px;
    background: linear-gradient(
        to right,
        transparent,
        var(--border-color) 20%,
        var(--border-color) 80%,
        transparent
    );
    margin: 20px 0;
}

/* Animation pour le bouton confirmer */
.btn-confirm {
    width: 100%;
    margin-top: 20px;
    transition: all 0.3s ease;
}

.btn-confirm:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
}

.btn-confirm:active {
    transform: translateY(0);
}

/* Badge de statut */
.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-top: 8px;
}

.status-badge.active {
    background: rgba(52, 199, 89, 0.1);
    color: var(--success-color);
}

.status-badge.inactive {
    background: rgba(142, 142, 147, 0.1);
    color: var(--text-secondary);
}

/* Responsive */
@media (max-width: 768px) {
    .mobile-money-header {
        flex-wrap: wrap;
    }
    
    .mobile-icon {
        width: 36px;
        height: 36px;
        font-size: 1.1rem;
    }
    
    .mobile-money-header h5 {
        font-size: 0.95rem;
    }
    
    .toggle-switch-small {
        width: 40px;
        height: 22px;
    }
    
    .toggle-slider-small:before {
        height: 16px;
        width: 16px;
    }
}
/* ==================== RESPONSIVE ==================== */
@media (max-width: 1024px) {
    .settings-container {
        grid-template-columns: 1fr;
    }

    .settings-sidebar {
        position: relative;
        top: 0;
    }
}

@media (max-width: 768px) {
    .header-container {
        padding: 12px 16px;
    }

    .brand-name {
        font-size: 1rem;
    }

    .user-name {
        display: none;
    }

    .settings-container {
        padding: 20px 16px;
    }

    .settings-section {
        padding: 20px;
    }

    .form-grid {
        grid-template-columns: 1fr;
    }

    .setting-item {
        flex-direction: column;
        gap: 12px;
        text-align: center;
    }

    .danger-actions {
        flex-direction: column;
    }

    .btn-primary,
    .btn-danger,
    .btn-confirm {
        width: 100%;
    }
}

@media (max-width: 480px) {
    .section-title {
        font-size: 1.2rem;
    }
}
/* Styles pour l'affichage de l'identifiant actuel */
#identifiantActuel h4 {
    font-size: 1rem;
    margin-bottom: 12px;
}

#lienBoutique {
    transition: all 0.3s ease;
}

#lienBoutique:focus {
    outline: none;
    border-color: var(--primary-color);
}

.url-preview {
    padding: 12px 16px;
    background: var(--bg-primary);
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 0.95rem;
    word-break: break-all;
}
/* ==================== MENU NAVIGATION MOBILE (ANDROID STYLE) ==================== */

#menu-mobile-android {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #1A1A1A;
    display: flex;
    justify-content: flex-start; /* Chang√© de space-around √† flex-start */
    align-items: center;
    padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
    z-index: 9999;
    border-radius: 24px 24px 0 0;
    overflow-x: auto; /* Permet le scroll horizontal */
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch; /* Scroll fluide sur iOS */
    gap: 4px; /* Espacement entre les boutons */
}

/* Cacher la scrollbar mais garder la fonctionnalit√© */
#menu-mobile-android::-webkit-scrollbar {
    display: none;
}

#menu-mobile-android {
    -ms-overflow-style: none;
    scrollbar-width: none;
}

.menu-mobile-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    background: none;
    border: none;
    color: #8E8E93;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 12px;
    transition: all 0.3s ease;
    position: relative;
    min-width: 65px; /* Largeur fixe pour chaque bouton */
    flex-shrink: 0; /* Emp√™che les boutons de r√©tr√©cir */
}

.menu-mobile-btn .link-icon {
    font-size: 22px;
    transition: transform 0.3s ease;
}

.menu-mobile-btn span:last-child {
    font-size: 9px;
    font-weight: 500;
    font-family: 'Poppins', sans-serif;
    white-space: nowrap; /* Emp√™che le texte de passer √† la ligne */
    text-align: center;
}

.menu-mobile-btn.active {
    color: #FF6B00;
}

.menu-mobile-btn.active span:last-child {
    font-weight: 600;
}

/* Indicateur actif */
.menu-mobile-btn .active-indicator {
    position: absolute;
    bottom: 2px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    background: #FF6B00;
    border-radius: 2px;
}

/* Effet tactile */
.menu-mobile-btn:active {
    transform: scale(0.95);
}

/* Hover effect (pour les appareils avec souris) */
@media (hover: hover) {
    .menu-mobile-btn:hover {
        background: rgba(255, 107, 0, 0.1);
    }
}

/* Animation d'apparition */
@keyframes slideUpMenu {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

#menu-mobile-android {
    animation: slideUpMenu 0.3s ease;
}
.modern-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 24px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 500;
    font-size: 15px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    border: 1px solid transparent;
}

.modern-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s ease;
}

.modern-link:hover::before {
    left: 100%;
}

.modern-link .link-icon {
    width: 22px;
    height: 22px;
    flex-shrink: 0;
    transition: transform 0.3s ease;
}

.modern-link:hover .link-icon {
    transform: scale(1.1) rotate(5deg);
}

/* WhatsApp Style */
.modern-link.whatsapp {
    background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
}

.modern-link.whatsapp:hover {
    background: linear-gradient(135deg, #128C7E 0%, #075E54 100%);
    box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
    transform: translateY(-2px);
}

/* Telegram Style */
.modern-link.telegram {
    background: linear-gradient(135deg, #0088cc 0%, #005f8c 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(0, 136, 204, 0.3);
}

.modern-link.telegram:hover {
    background: linear-gradient(135deg, #005f8c 0%, #004466 100%);
    box-shadow: 0 6px 20px rgba(0, 136, 204, 0.4);
    transform: translateY(-2px);
}

/* Version alternative avec bordures */
.modern-link.outline {
    background: transparent;
    border: 2px solid currentColor;
}

.modern-link.whatsapp.outline {
    color: #25D366;
    border-color: #25D366;
}

.modern-link.whatsapp.outline:hover {
    background: #25D366;
    color: white;
}

.modern-link.telegram.outline {
    color: #0088cc;
    border-color: #0088cc;
}

.modern-link.telegram.outline:hover {
    background: #0088cc;
    color: white;
}
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
/* ==================== MODAL PREVIEW BOUTIQUE ==================== */
#previewModal {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(6px);
    align-items: center;
    justify-content: center;
    padding: 16px;
}
#previewModal.active {
    display: flex;
    animation: fadeIn 0.25s ease;
}
.preview-modal-box {
    background: #fff;
    border-radius: 20px;
    width: 100%;
    max-width: 420px;
    height: 85vh;
    max-height: 800px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 24px 60px rgba(0,0,0,0.3);
    animation: slideUpPreview 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
@keyframes slideUpPreview {
    from { opacity: 0; transform: translateY(40px) scale(0.97); }
    to   { opacity: 1; transform: translateY(0)    scale(1); }
}
.preview-modal-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 18px;
    border-bottom: 1px solid #E5E7EB;
    background: #F8F9FA;
    flex-shrink: 0;
    gap: 10px;
}
.preview-modal-dots {
    display: flex;
    gap: 5px;
}
.preview-modal-dots span {
    width: 10px;
    height: 10px;
    border-radius: 50%;
}
.preview-modal-dots span:nth-child(1) { background: #FF5F56; }
.preview-modal-dots span:nth-child(2) { background: #FFBD2E; }
.preview-modal-dots span:nth-child(3) { background: #27C93F; }
.preview-modal-url {
    flex: 1;
    background: #fff;
    border: 1px solid #E5E7EB;
    border-radius: 8px;
    padding: 5px 10px;
    font-size: 0.75rem;
    color: #6B7280;
    font-family: monospace;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
}
.preview-modal-close {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.3rem;
    color: #6B7280;
    line-height: 1;
    padding: 2px 6px;
    border-radius: 6px;
    transition: all 0.2s;
}
.preview-modal-close:hover { background: #F3F4F6; color: #1A1A1A; }
.preview-modal-iframe {
    flex: 1;
    border: none;
    width: 100%;
    background: #fff;
}
.preview-modal-footer {
    padding: 10px 18px;
    border-top: 1px solid #E5E7EB;
    background: #F8F9FA;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    flex-shrink: 0;
}
.preview-reload-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}
.preview-reload-btn:hover { opacity: 0.85; }
.preview-open-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    background: transparent;
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;
}
.preview-open-btn:hover { background: var(--primary-color); color: white; }
</style>
<body>
    <!-- Menu Hamburger Overlay -->
    <div class="hamburger-overlay" id="hamburgerOverlay"></div>
    
    <!-- Menu Hamburger -->
    <div class="hamburger-menu" id="hamburgerMenu">
        <div class="hamburger-header">
            <div class="brand-section">
                <div class="logo-image"></div>
                <h1 class="brand-name">ODA</h1>
            </div>
            <button class="close-menu" id="closeMenu">
                <span>√ó</span>
            </button>
        </div>
        
        <nav class="hamburger-nav">
            <a href="tableau.html" class="hamburger-link">
                <span class="link-icon">üìä</span>
                <span>Tableau de bord</span>
            </a>
            <a href="produit.html" class="hamburger-link">
                <span class="link-icon">üì¶</span>
                <span>Produits</span>
            </a>
            <a href="commandes.html" class="hamburger-link">
                <span class="link-icon">üìã</span>
                <span>Commandes</span>
            </a>
            <a href="clients.html" class="hamburger-link">
                <span class="link-icon">üë•</span>
                <span>Clients</span>
            </a>
            <a href="messages.html" class="hamburger-link">
                <span class="link-icon">üí¨</span>
                <span>Messages</span>
            </a>
            
            <div class="hamburger-divider"></div>
            
            <a href="statitique.html" class="hamburger-link">
                <span class="link-icon">üìà</span>
                <span>Statistiques</span>
            </a>
            <a href="parametres.html" class="hamburger-link active">
                <span class="link-icon">‚öôÔ∏è</span>
                <span>Param√®tres</span>
            </a>
            <a href="boutique.html" class="hamburger-link">
                <span class="link-icon">ü™ü</span>
                <span>Voir ma boutique</span>
            </a>
        </nav>
        
        <a href="https://whatsapp.com/channel/0029Vb6mcUm5q08htMMdVA2v" class="modern-link whatsapp">
            <svg class="link-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z" fill="currentColor"/>
                <path d="M20.52 3.449C18.24 1.245 15.24 0 12.045 0 5.463 0 .104 5.334.101 11.893c0 2.096.549 4.14 1.595 5.945L0 24l6.335-1.652c1.746.943 3.71 1.444 5.71 1.447h.006c6.585 0 11.946-5.336 11.949-11.896 0-3.176-1.24-6.165-3.48-8.4zm-8.475 18.3c-1.778 0-3.52-.478-5.038-1.378l-.36-.214-3.746.977.999-3.648-.235-.374c-.99-1.575-1.515-3.396-1.515-5.261.003-5.45 4.436-9.884 9.9-9.884 2.64 0 5.122 1.03 6.988 2.898 1.867 1.869 2.893 4.352 2.89 6.988-.002 5.453-4.437 9.896-9.883 9.896z" fill="currentColor"/>
            </svg>
            <span>Rejoindre notre cha√Æne</span>
        </a>
        
        <a href="https://t.me/+hqymnTrseaU2OWRk" class="modern-link telegram">
            <svg class="link-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z" fill="currentColor"/>
            </svg>
            <span>Rejoindre notre groupe Telegram</span>
        </a>
    </div>

    <header class="main-header">
        <div class="header-container">
            <button class="hamburger-btn" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <div class="brand-section">
                <div class="logo-image"></div>
                <h1 class="brand-name">Param√®tres</h1>
            </div>

            <div class="header-actions">
                <button class="icon-btn notification-btn">
                    <span>üîî</span>
                    <span class="badge">3</span>
                </button>
                <div class="user-profile">
                    <div class="avatar-image"></div>
                    <span class="user-name">Admin</span>
                </div>
            </div>
        </div>
    </header>

    <div class="settings-container">
        <aside class="settings-sidebar">
            <ul class="settings-menu">
                <li class="settings-menu-item">
                    <a href="#general" class="settings-menu-link active" data-section="general">
                        <span class="settings-icon">üè™</span>
                        <span>G√©n√©ral</span>
                    </a>
                </li>
                <li class="settings-menu-item">
                    <a href="#identifiant" class="settings-menu-link" data-section="identifiant">
                        <span class="settings-icon">üîñ</span>
                        <span>Identifiant unique</span>
                    </a>
                </li>
                <li class="settings-menu-item">
                    <a href="#payment" class="settings-menu-link" data-section="payment">
                        <span class="settings-icon">üí≥</span>
                        <span>Paiement</span>
                    </a>
                </li>
                <li class="settings-menu-item">
                    <a href="#shipping" class="settings-menu-link" data-section="shipping">
                        <span class="settings-icon">üì¶</span>
                        <span>Livraison</span>
                    </a>
                </li>
                <li class="settings-menu-item">
                    <a href="#notifications" class="settings-menu-link" data-section="notifications">
                        <span class="settings-icon">üîî</span>
                        <span>Notifications</span>
                    </a>
                </li>
                <li class="settings-menu-item">
                    <a href="#security" class="settings-menu-link" data-section="security">
                        <span class="settings-icon">üîí</span>
                        <span>S√©curit√©</span>
                    </a>
                    <a href="#apparence" class="settings-menu-link" data-section="apparence">
                        <span class="settings-icon">üé®</span>
                        <span>Apparence</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="settings-content">
            <!-- Section G√©n√©ral -->
            <section id="general" class="settings-section">
                <div class="section-header">
                    <h3 class="section-title">Informations g√©n√©rales</h3>
                    <p class="section-description">Configurez les informations de base de votre boutique</p>
                </div>

                <form id="generalForm">
                    <div class="form-group">
                        <label class="form-label">Nom de la boutique</label>
                        <input type="text" class="form-input" id="shopName" placeholder="Ma Boutique √âl√©gante">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="shopDescription" placeholder="D√©crivez votre boutique..."></textarea>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Email de contact</label>
                            <input type="email" class="form-input" id="shopEmail" placeholder="contact@boutique.com">
                        </div>

                        <div class="form-group">
                            <label class="form-label">T√©l√©phone (whatsapp)</label>
                            <input type="tel" class="form-input" id="shopPhone" placeholder="+237 6 XX XX XX XX">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Adresse</label>
                        <input type="text" class="form-input" id="shopAddress" placeholder="Douala, Cameroun">
                    </div>

                    <button type="submit" class="btn-primary">üíæ Enregistrer les modifications</button>
                </form>
            </section>

            <section id="identifiant" class="settings-section" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">Identifiant unique de la boutique</h3>
                    <p class="section-description">Cr√©ez un nom unique pour votre boutique (URL personnalis√©e)</p>
                </div>
            
                <div class="alert-info">
                    <span class="alert-icon">‚ÑπÔ∏è</span>
                    <div>
                        <strong>√Ä quoi sert l'identifiant unique ?</strong>
                        <p>Cet identifiant sera utilis√© dans l'URL de votre boutique et permettra √† vos clients d'acc√©der directement √† votre boutique.</p>
                    </div>
                </div>
            
                <!-- Affichage de l'identifiant actuel -->
                <div id="identifiantActuel" style="display: none; margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(52, 199, 89, 0.05)); border-radius: 12px; border-left: 4px solid #34C759;">
                    <h4 style="margin-bottom: 12px; color: #34C759; font-weight: 600;">‚úÖ Identifiant actif</h4>
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <span style="font-family: monospace; font-size: 1.1rem; font-weight: 600;">@</span>
                        <span id="identifiantActif" style="font-family: monospace; font-size: 1.1rem; font-weight: 600; color: var(--primary-color);"></span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong>Lien de votre boutique :</strong>
                        <div style="display: flex; gap: 8px; align-items: center; margin-top: 8px;">
                            <input type="text" id="lienBoutique" readonly style="flex: 1; padding: 10px; border: 2px solid #E5E7EB; border-radius: 8px; font-family: monospace; background: white;">
                            <button type="button" onclick="copierLienBoutique()" class="btn-secondary" style="padding: 10px 20px; white-space: nowrap;">
                                üìã Copier
                            </button>
                        </div>
                    </div>
                    <button type="button" onclick="afficherFormulaireModification()" class="btn-secondary" style="background: transparent; color: var(--primary-color); border: 2px solid var(--primary-color);">
                        ‚úèÔ∏è Modifier l'identifiant
                    </button>
                </div>
            
                <!-- Formulaire de cr√©ation/modification -->
                <form id="identifiantForm">
                    <div class="form-group">
                        <label class="form-label">Identifiant unique (slug)</label>
                        <div class="input-with-prefix">
                            <span class="input-prefix">@</span>
                            <input type="text" class="form-input" id="shopSlug" placeholder="ma-boutique-elegante" pattern="[a-z0-9-]+" maxlength="50">
                        </div>
                        <small class="form-hint">Uniquement des lettres minuscules, chiffres et tirets (minimum 3 caract√®res)</small>
                        <div id="slugAvailability" class="slug-status"></div>
                    </div>
            
                    <div class="preview-url">
                        <strong>Aper√ßu de votre URL :</strong>
                        <div class="url-preview">
                            <span id="urlBase"></span><span>?shop=</span><span id="slugPreview">votre-identifiant</span>
                        </div>
                    </div>
            
                    <button type="submit" class="btn-primary">üîñ D√©finir l'identifiant</button>
                </form>
            </section>

            <!-- Section Paiement -->
            <section id="payment" class="settings-section" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">M√©thodes de paiement</h3>
                    <p class="section-description">Configurez vos options de paiement</p>
                </div>

                <div class="payment-methods">
                    <div class="payment-card">
                        <div class="payment-header">
                            <div class="payment-info">
                                <span class="payment-icon">üí≥</span>
                                <div>
                                    <h4>Carte bancaire</h4>
                                    <p>Visa, Mastercard, American Express</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="paymentCard">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="payment-details" id="cardDetails" style="display: none;">
                            <input type="text" class="form-input" placeholder="Cl√© API Stripe" id="stripeKey">
                            <button type="button" class="btn-confirm" onclick="confirmerPaiement('card')">‚úì Confirmer</button>
                        </div>
                    </div>

                    <div class="payment-card">
                        <div class="payment-header">
                            <div class="payment-info">
                                <span class="payment-icon">üì±</span>
                                <div>
                                    <h4>Mobile Money</h4>
                                    <p>MTN Money & Orange Money</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="paymentMobile">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="payment-details" id="mobileDetails" style="display: none;">
                            <!-- Section MTN Money -->
                            <div class="mobile-money-section">
                                <div class="mobile-money-header">
                                    <span class="mobile-icon" style="background: #FFCC00; color: #000;">üìû</span>
                                    <h5>MTN Money</h5>
                                    <label class="toggle-switch-small">
                                        <input type="checkbox" id="mtnActive">
                                        <span class="toggle-slider-small"></span>
                                    </label>
                                </div>
                                
                                <div class="mobile-money-inputs" id="mtnInputs" style="display: none;">
                                    <div class="form-group">
                                        <label class="form-label">Nom du compte MTN</label>
                                        <input type="text" 
                                               class="form-input" 
                                               id="mtnNomCompte" 
                                               placeholder="Ex: KAMGA Jean">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Num√©ro MTN Money</label>
                                        <input type="tel" 
                                               class="form-input" 
                                               id="mtnNumero" 
                                               placeholder="+237 6 XX XX XX XX"
                                               pattern="[0-9+\s]*">
                                        <small class="form-hint">Format: +237 6XX XX XX XX</small>
                                    </div>
                                </div>
                            </div>
                    
                            <div class="mobile-divider"></div>
                    
                            <!-- Section Orange Money -->
                            <div class="mobile-money-section">
                                <div class="mobile-money-header">
                                    <span class="mobile-icon" style="background: #FF7900; color: #fff;">üçä</span>
                                    <h5>Orange Money</h5>
                                    <label class="toggle-switch-small">
                                        <input type="checkbox" id="orangeActive">
                                        <span class="toggle-slider-small"></span>
                                    </label>
                                </div>
                                
                                <div class="mobile-money-inputs" id="orangeInputs" style="display: none;">
                                    <div class="form-group">
                                        <label class="form-label">Nom du compte Orange</label>
                                        <input type="text" 
                                               class="form-input" 
                                               id="orangeNomCompte" 
                                               placeholder="Ex: KAMGA Jean">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Num√©ro Orange Money</label>
                                        <input type="tel" 
                                               class="form-input" 
                                               id="orangeNumero" 
                                               placeholder="+237 6 XX XX XX XX"
                                               pattern="[0-9+\s]*">
                                        <small class="form-hint">Format: +237 6XX XX XX XX</small>
                                    </div>
                                </div>
                            </div>
                    
                            <button type="button" class="btn-confirm" id="confirmerMobileMoney">
                                ‚úì Confirmer les param√®tres Mobile Money
                            </button>
                        </div>
                    </div>

                    <div class="payment-card">
                        <div class="payment-header">
                            <div class="payment-info">
                                <span class="payment-icon">üíµ</span>
                                <div>
                                    <h4>Paiement √† la livraison</h4>
                                    <p>Esp√®ces √† la r√©ception</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="paymentCash">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="payment-details" id="cashDetails" style="display: none;">
                            <p class="info-text">‚úì Aucune configuration requise</p>
                            <button type="button" class="btn-confirm" onclick="confirmerPaiement('cash')">‚úì Confirmer</button>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 32px;">
                    <label class="form-label">Devise</label>
                    <select class="form-select" id="currency">
                        <option value="FCFA">FCFA (Franc CFA)</option>
                        <option value="EUR">EUR (Euro)</option>
                        <option value="USD">USD (Dollar)</option>
                    </select>
                </div>
            </section>
    


          <!-- REMPLACEZ VOTRE SECTION LIVRAISON PAR CELLE-CI -->
<section id="shipping" class="settings-section" style="display: none;">
    <div class="section-header">
        <h3 class="section-title">Options de livraison</h3>
        <p class="section-description">Configurez vos zones et frais de livraison</p>
    </div>

    <form id="shippingForm">
        <!-- Zones de livraison par d√©faut -->
        <div style="background: var(--gradient-soft); padding: var(--spacing-lg); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg);">
            <h4 style="color: var(--primary-color); margin-bottom: var(--spacing-md); font-weight: 600;">üìç Zones principales</h4>
            
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Frais de livraison (Douala)</label>
                    <input type="number" class="form-input" id="fraisDouala" value="1000" placeholder="0" min="0">
                    <small style="color: var(--text-secondary); font-size: 0.85rem;">FCFA</small>
                </div>

                <div class="form-group">
                    <label class="form-label">Frais de livraison (Autres villes)</label>
                    <input type="number" class="form-input" id="fraisAutres" value="2500" placeholder="0" min="0">
                    <small style="color: var(--text-secondary); font-size: 0.85rem;">FCFA</small>
                </div>
            </div>
        </div>

        <!-- Zones de livraison personnalis√©es -->
        <div style="margin-bottom: var(--spacing-lg);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <h4 style="color: var(--primary-color); font-weight: 600;">üó∫Ô∏è Zones personnalis√©es</h4>
                <button type="button" class="btn-secondary" id="ajouterZone" style="padding: var(--spacing-xs) var(--spacing-md); font-size: 0.9rem;">
                    ‚ûï Ajouter une zone
                </button>
            </div>

            <div id="zonesContainer">
                <!-- Les zones personnalis√©es seront ajout√©es ici dynamiquement -->
            </div>

            <div id="emptyZonesMessage" style="text-align: center; padding: var(--spacing-xl); color: var(--text-secondary); background: var(--gradient-soft); border-radius: var(--radius-lg); border: 2px dashed rgba(199, 125, 255, 0.2);">
                <p style="font-size: 1.1rem; margin-bottom: var(--spacing-xs);">üì¶</p>
                <p>Aucune zone personnalis√©e ajout√©e</p>
                <small style="font-size: 0.85rem;">Cliquez sur "Ajouter une zone" pour commencer</small>
            </div>
        </div>

        <!-- Autres param√®tres -->
        <div class="form-group">
            <label class="form-label">D√©lai de livraison estim√©</label>
            <input type="text" class="form-input" id="delaiLivraison" value="2-5 jours ouvrables" placeholder="Ex: 2-5 jours">
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h4>üéÅ Livraison gratuite</h4>
                <p>Activer la livraison gratuite au-del√† d'un montant</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="freeShipping">
                <span class="toggle-slider"></span>
            </label>
        </div>

        <div class="form-group">
            <label class="form-label">Montant minimum pour livraison gratuite (FCFA)</label>
            <input type="number" class="form-input" id="montantMinimum" value="50000" placeholder="50000" min="0">
        </div>

        <button type="submit" class="btn-primary">üì¶ Sauvegarder</button>
    </form>
</section>
            <!-- Section Notifications -->
            <section id="notifications" class="settings-section" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">Pr√©f√©rences de notifications</h3>
                    <p class="section-description">G√©rez vos notifications et alertes</p>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Nouvelles commandes</h4>
                        <p>Recevoir une notification pour chaque nouvelle commande</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifOrders">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Stock faible</h4>
                        <p>Alerte quand un produit atteint le stock minimum</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifStock">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Nouveaux clients</h4>
                        <p>Notification lors de l'inscription d'un nouveau client</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifClients">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Rapports hebdomadaires</h4>
                        <p>Recevoir un r√©sum√© des ventes chaque semaine</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifReports">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </section>
            <!-- Section S√©curit√© -->
            <section id="security" class="settings-section" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title">S√©curit√© et confidentialit√©</h3>
                    <p class="section-description">Prot√©gez votre compte et vos donn√©es</p>
                </div>

                <form id="securityForm">
                    <div class="form-group">
                        <label class="form-label">Mot de passe actuel</label>
                        <input type="password" class="form-input" id="currentPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nouveau mot de passe</label>
                        <input type="password" class="form-input" id="newPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirmer le mot de passe</label>
                        <input type="password" class="form-input" id="confirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>

                    <button type="submit" class="btn-primary">üîí Changer le mot de passe</button>
                </form>

                <div class="danger-zone">
                    <h4>Zone de danger</h4>
                    <p>Ces actions sont irr√©versibles. Proc√©dez avec prudence.</p>
                    <div class="danger-actions">
                        <button type="button" class="btn-danger" onclick="exporterDonnees()">üì• Exporter mes donn√©es</button>
                        <button type="button" class="btn-danger" onclick="supprimerCompte()">üóëÔ∏è Supprimer mon compte</button>
                    </div>
                </div>
            </section>
            <!-- Section Apparence compl√®te (√† ajouter apr√®s la section security) -->
<section id="apparence" class="settings-section" style="display: none;">
    <div class="section-header">
        <h3 class="section-title">Personnalisation de l'apparence</h3>
        <p class="section-description">Personnalisez les couleurs et l'identit√© visuelle de votre boutique en ligne</p>
    </div>

    <div class="alert-info" style="display: flex; gap: 12px; padding: 16px; background: rgba(0, 122, 255, 0.1); border-left: 4px solid var(--primary-color); border-radius: 10px; margin-bottom: 24px;">
        <span style="font-size: 1.5rem;">‚ÑπÔ∏è</span>
        <div>
            <strong>Information importante</strong>
            <p style="margin-top: 4px; color: var(--text-secondary); font-size: 0.9rem;">
                Les modifications d'apparence seront appliqu√©es √† votre boutique e-commerce en temps r√©el.
            </p>
        </div>
    </div>

    <!-- Couleurs -->
    <div class="appearance-group">
        <h4 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">üé® Couleurs du site</h4>
        
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">Couleur primaire</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <input type="color" class="color-picker" id="primaryColor" value="#FF6B00">
                    <div class="color-preview" id="primaryColorPreview" style="width: 60px; height: 40px; border-radius: 8px; border: 2px solid var(--border-color); background: #FF6B00;"></div>
                    <input type="text" class="form-input" id="primaryColorHex" value="#FF6B00" readonly style="max-width: 100px; font-family: monospace;">
                </div>
                <small class="form-hint">Couleur principale de votre boutique (boutons, liens, etc.)</small>
            </div>

            <div class="form-group">
                <label class="form-label">Couleur secondaire</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <input type="color" class="color-picker" id="secondaryColor" value="#1A1A1A">
                    <div class="color-preview" id="secondaryColorPreview" style="width: 60px; height: 40px; border-radius: 8px; border: 2px solid var(--border-color); background: #1A1A1A;"></div>
                    <input type="text" class="form-input" id="secondaryColorHex" value="#1A1A1A" readonly style="max-width: 100px; font-family: monospace;">
                </div>
                <small class="form-hint">Couleur secondaire (textes, arri√®re-plans)</small>
            </div>
        </div>

        <div class="color-presets" style="margin-top: 16px;">
            <label class="form-label">Palettes pr√©d√©finies</label>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; margin-top: 8px;">
                <button class="preset-btn" onclick="appliquerPalette('#FF6B00', '#1A1A1A')" style="padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; background: white; transition: all 0.3s ease;">
                    <div style="display: flex; gap: 4px; margin-bottom: 4px;">
                        <div style="flex: 1; height: 30px; background: #FF6B00; border-radius: 4px;"></div>
                        <div style="flex: 1; height: 30px; background: #1A1A1A; border-radius: 4px;"></div>
                    </div>
                    <small style="font-size: 0.75rem; font-weight: 600;">Orange/Noir</small>
                </button>

                <button class="preset-btn" onclick="appliquerPalette('#007AFF', '#1D1D1F')" style="padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; background: white; transition: all 0.3s ease;">
                    <div style="display: flex; gap: 4px; margin-bottom: 4px;">
                        <div style="flex: 1; height: 30px; background: #007AFF; border-radius: 4px;"></div>
                        <div style="flex: 1; height: 30px; background: #1D1D1F; border-radius: 4px;"></div>
                    </div>
                    <small style="font-size: 0.75rem; font-weight: 600;">Bleu/Noir</small>
                </button>

                <button class="preset-btn" onclick="appliquerPalette('#34C759', '#2C3E50')" style="padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; background: white; transition: all 0.3s ease;">
                    <div style="display: flex; gap: 4px; margin-bottom: 4px;">
                        <div style="flex: 1; height: 30px; background: #34C759; border-radius: 4px;"></div>
                        <div style="flex: 1; height: 30px; background: #2C3E50; border-radius: 4px;"></div>
                    </div>
                    <small style="font-size: 0.75rem; font-weight: 600;">Vert/Bleu nuit</small>
                </button>

                <button class="preset-btn" onclick="appliquerPalette('#FF3B30', '#1A1A1A')" style="padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; background: white; transition: all 0.3s ease;">
                    <div style="display: flex; gap: 4px; margin-bottom: 4px;">
                        <div style="flex: 1; height: 30px; background: #FF3B30; border-radius: 4px;"></div>
                        <div style="flex: 1; height: 30px; background: #1A1A1A; border-radius: 4px;"></div>
                    </div>
                    <small style="font-size: 0.75rem; font-weight: 600;">Rouge/Noir</small>
                </button>

                <button class="preset-btn" onclick="appliquerPalette('#9C27B0', '#212121')" style="padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; background: white; transition: all 0.3s ease;">
                    <div style="display: flex; gap: 4px; margin-bottom: 4px;">
                        <div style="flex: 1; height: 30px; background: #9C27B0; border-radius: 4px;"></div>
                        <div style="flex: 1; height: 30px; background: #212121; border-radius: 4px;"></div>
                    </div>
                    <small style="font-size: 0.75rem; font-weight: 600;">Violet/Noir</small>
                </button>

                <button class="preset-btn" onclick="appliquerPalette('#FF9500', '#2C2C2E')" style="padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; background: white; transition: all 0.3s ease;">
                    <div style="display: flex; gap: 4px; margin-bottom: 4px;">
                        <div style="flex: 1; height: 30px; background: #FF9500; border-radius: 4px;"></div>
                        <div style="flex: 1; height: 30px; background: #2C2C2E; border-radius: 4px;"></div>
                    </div>
                    <small style="font-size: 0.75rem; font-weight: 600;">Dor√©/Gris fonc√©</small>
                </button>
            </div>
        </div>
    </div>

    <div class="hamburger-divider" style="margin: 32px 0;"></div>

   <!-- Police -->
   <div class="appearance-group">
    <h4 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">üìù Typographie</h4>
    
    <div class="form-group">
        <label class="form-label">Police d'√©criture</label>
        <select class="form-select" id="fontFamily">
            <optgroup label="‚Äî Sans-Serif Modernes">
                <option value="Inter">Inter ‚Äî Moderne & Tech</option>
                <option value="Poppins">Poppins ‚Äî Douce & Arrondie</option>
                <option value="Nunito">Nunito ‚Äî Conviviale & Ronde</option>
                <option value="DM Sans">DM Sans ‚Äî Propre & Minimaliste</option>
                <option value="Plus Jakarta Sans">Plus Jakarta Sans ‚Äî Contemporaine</option>
                <option value="Outfit">Outfit ‚Äî G√©om√©trique & Claire</option>
            </optgroup>
            <optgroup label="‚Äî √âl√©gantes & Professionnelles">
                <option value="Montserrat">Montserrat ‚Äî √âl√©gante</option>
                <option value="Raleway">Raleway ‚Äî Raffin√©e & Fine</option>
                <option value="Josefin Sans">Josefin Sans ‚Äî Sophistiqu√©e</option>
                <option value="Lato">Lato ‚Äî Professionnelle & Neutre</option>
                <option value="Open Sans">Open Sans ‚Äî Tr√®s Lisible</option>
                <option value="Roboto">Roboto ‚Äî Classique Google</option>
            </optgroup>
            <optgroup label="‚Äî Luxe & √âditorial">
                <option value="Playfair Display">Playfair Display ‚Äî Luxe & Serif</option>
                <option value="Cormorant Garamond">Cormorant Garamond ‚Äî Haute Couture</option>
                <option value="Libre Baskerville">Libre Baskerville ‚Äî √âditoriale</option>
                <option value="DM Serif Display">DM Serif Display ‚Äî √âl√©gance Moderne</option>
            </optgroup>
            <optgroup label="‚Äî Cr√©atives & Originales">
                <option value="Pacifico">Pacifico ‚Äî Manuscrite & Fun</option>
                <option value="Righteous">Righteous ‚Äî Dynamique & R√©tro</option>
                <option value="Bebas Neue">Bebas Neue ‚Äî Impact & Puissante</option>
                <option value="Abril Fatface">Abril Fatface ‚Äî Audacieuse</option>
            </optgroup>
        </select>
        <small class="form-hint">Cette police sera appliqu√©e sur tout votre site e-commerce</small>
    </div>

    <!-- Cartes visuelles de pr√©visualisation -->
    <div id="fontPreviewCards" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; margin-top: 16px;">
        <!-- G√©n√©r√©es dynamiquement par JS -->
    </div>

    <div class="font-preview" style="margin-top: 16px; padding: 24px; background: var(--bg-primary); border-radius: 12px; border: 2px solid var(--border-color);">
        <p style="font-size: 1.4rem; font-weight: 700; margin-bottom: 6px;" id="fontPreviewTitle">Ma Boutique √âl√©gante</p>
        <p style="font-size: 1rem; font-weight: 500; margin-bottom: 8px; color: var(--primary-color);" id="fontPreviewSubtitle">D√©couvrez notre nouvelle collection</p>
        <p style="font-size: 0.88rem; color: var(--text-secondary); line-height: 1.6;" id="fontPreviewText">
            Voici comment appara√Ætra le texte dans votre boutique. Les titres seront clairs, les descriptions agr√©ables √† lire.
        </p>
        <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
            <span id="fontPreviewBadge" style="padding: 4px 14px; background: var(--primary-color); color: white; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Ajouter au panier</span>
            <span id="fontPreviewPrice" style="padding: 4px 14px; border: 2px solid var(--primary-color); color: var(--primary-color); border-radius: 20px; font-size: 0.8rem; font-weight: 600;">25 000 FCFA</span>
        </div>
        <p style="margin-top: 12px; font-size: 0.75rem; color: var(--text-secondary); font-style: italic;" id="fontPreviewName">Police actuelle : Inter</p>
    </div>
</div>

    <!-- Logo et Favicon -->
    <div class="appearance-group">
        <h4 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">üñºÔ∏è Identit√© visuelle</h4>
        
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">Logo de la boutique</label>
                <div class="upload-area" style="border: 2px dashed var(--border-color); border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="document.getElementById('logoUpload').click()">
                    <div id="logoPreview" style="margin-bottom: 12px; min-height: 100px; display: flex; align-items: center; justify-content: center;">
                        <div style="color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 8px;">üñºÔ∏è</div>
                            <p style="font-weight: 600;">Cliquez pour charger un logo</p>
                            <small style="font-size: 0.85rem;">PNG, JPG, SVG (max 2MB)</small>
                        </div>
                    </div>
                </div>
                <input type="file" id="logoUpload" accept="image/*" style="display: none;">
                <small class="form-hint">Dimensions recommand√©es : 200x80 pixels</small>
            </div>

            <div class="form-group">
                <label class="form-label">Favicon (ic√¥ne de l'onglet)</label>
                <div class="upload-area" style="border: 2px dashed var(--border-color); border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="document.getElementById('faviconUpload').click()">
                    <div id="faviconPreview" style="margin-bottom: 12px; min-height: 100px; display: flex; align-items: center; justify-content: center;">
                        <div style="color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 8px;">üîñ</div>
                            <p style="font-weight: 600;">Cliquez pour charger un favicon</p>
                            <small style="font-size: 0.85rem;">PNG, ICO (max 2MB)</small>
                        </div>
                    </div>
                </div>
                <input type="file" id="faviconUpload" accept="image/*" style="display: none;">
                <small class="form-hint">Dimensions recommand√©es : 32x32 pixels</small>
            </div>
        </div>
    </div>

    <div class="hamburger-divider" style="margin: 32px 0;"></div>

    <!-- Aper√ßu en direct -->
    <div class="appearance-group">
        <h4 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">üëÅÔ∏è Aper√ßu en direct</h4>
        
        <div class="live-preview" style="padding: 24px; background: var(--bg-primary); border-radius: 16px; border: 2px solid var(--border-color);">
            <div style="margin-bottom: 16px;">
                <button class="preview-btn-primary" style="padding: 12px 24px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-right: 12px; transition: all 0.3s ease;">
                    Bouton principal
                </button>
                <button class="preview-btn-secondary" style="padding: 12px 24px; background: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    Bouton secondaire
                </button>
            </div>
            
            <div class="preview-card" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                <h3 style="color: var(--primary-color); margin-bottom: 8px; font-weight: 600;">Exemple de carte produit</h3>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 12px;">
                    Ceci est un aper√ßu de la fa√ßon dont vos produits appara√Ætront avec les couleurs s√©lectionn√©es.
                </p>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">25,000 FCFA</span>
                    <button style="padding: 8px 16px; background: var(--primary-color); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                        Ajouter au panier
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Boutons d'action -->
    <div style="display: flex; gap: 12px; margin-top: 32px; flex-wrap: wrap;">
        <button type="button" class="btn-primary" id="saveAppearance">
            üíæ Sauvegarder l'apparence
        </button>
        <button type="button" class="btn-secondary" id="resetAppearance" style="background: transparent; color: var(--text-primary); border: 2px solid var(--border-color);">
            ‚ôªÔ∏è R√©initialiser par d√©faut
        </button>
        <button type="button" class="btn-secondary" id="previewEcommerce" style="background: var(--primary-color); color: white; border: none;">
            üëÅÔ∏è Pr√©visualiser sur la boutique
        </button>
    </div>
</section>
        </main>
    </div>
    <script src="cache-manager.js"></script>
 <script type="module">
// ==================== PARTIE 1/4 : CONFIG, AUTH & SAUVEGARDE ====================

// ‚úÖ Corriger d'abord les credentials Supabase
const SUPABASE_URL = 'https://xjckbqbqxcwzcrlmuvzf.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqY2ticWJxeGN3emNybG11dnpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MTk1MzMsImV4cCI6MjA3NjA5NTUzM30.AMzAUwtjFt7Rvof5r2enMyYIYToc1wNWWEjvZqK_YXM';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ==================== √âTAT GLOBAL ====================
let currentUser = null;
let parametres = {
    general: { nom: '', description: '', email: '', telephone: '', adresse: '' },
    identifiant: { slug: '', disponible: false },
    paiement: {
        carte:  { actif: false, cle: '', confirme: false },
        mobile: {
            actif: false, confirme: false,
            mtn:    { actif: false, nomCompte: '', numero: '', confirme: false },
            orange: { actif: false, nomCompte: '', numero: '', confirme: false }
        },
        cash:   { actif: false, confirme: false },
        devise: 'FCFA'
    },
    livraison: {
        fraisDouala: 1000,
        fraisAutres: 2500,
        delai: '2-5 jours ouvrables',
        gratuit: false,
        montantMin: 50000,
        zonesPersonnalisees: []
    },
    apparence: {
        couleurPrimaire:   '#FF6B00',
        couleurSecondaire: '#1A1A1A',
        logo:    '',
        favicon: '',
        police:  'Inter'
    },
    notifications: { commandes: true, stock: true, clients: false, rapports: true }
};

// ==================== AUTHENTIFICATION ====================
async function verifierAuthentification() {
    try {
        // Tentative 1 : session directe
        let { data: { session } } = await supabase.auth.getSession();

        // Tentative 2 : si null, attendre onAuthStateChange (max 3 secondes)
        if (!session) {
            session = await new Promise((resolve) => {
                const timeout = setTimeout(() => resolve(null), 3000);
                supabase.auth.onAuthStateChange((_event, s) => {
                    clearTimeout(timeout);
                    resolve(s);
                });
            });
        }

        if (!session) {
            console.warn('‚ö†Ô∏è Aucune session active');
            window.location.href = 'connexion.html';
            return;
        }

        currentUser = session.user;
        const el = document.querySelector('.user-name');
        if (el) el.textContent = currentUser.email.split('@')[0];

    } catch (e) {
        console.error('Erreur auth:', e);
        window.location.href = 'connexion.html';
    }
}

// ==================== CHARGEMENT PARAM√àTRES ====================
async function chargerParametres() {
    try {
        const { data } = await supabase
            .from('parametres_boutique')
            .select('*')
            .eq('user_id', currentUser.id)
            .single();

        if (data) {
            parametres = { ...parametres, ...data.config };
        } else {
            const local = localStorage.getItem(`parametres_${currentUser.id}`);
            if (local) {
                try { parametres = { ...parametres, ...JSON.parse(local) }; } catch (_) {}
            }
        }
    } catch (_) {}

    await initialiserIdentifiantUnique();
    appliquerParametres();
}


async function sauvegarderParametres() {
    // 1. Sauvegarde locale imm√©diate (jamais bloquante)
    const _syncLocal = () => {
        if (!currentUser?.id) return;
        const json = JSON.stringify(parametres);
        localStorage.setItem(`parametres_${currentUser.id}`, json);
        // Cl√© lue par boutique.html
        localStorage.setItem('parametres_boutique', json);
        // Invalider le cache visiteur ‚Üí boutique.html rechargera depuis Supabase
        if (parametres.identifiant?.slug) {
            localStorage.removeItem(`boutique_cache_${parametres.identifiant.slug}`);
        }
        _exposerConfigPaiement();
    };

    if (!currentUser?.id) { _syncLocal(); return false; }

    try {
        // 2. Appel Supabase avec timeout de 5 secondes
        const timeout = new Promise((_, reject) =>
            setTimeout(() => reject(new Error('Timeout')), 5000)
        );
        const upsert = supabase
            .from('parametres_boutique')
            .upsert({ user_id: currentUser.id, config: parametres, updated_at: new Date().toISOString() },
                    { onConflict: 'user_id' });

        const { error } = await Promise.race([upsert, timeout]);
        if (error) throw error;

        _syncLocal();
        return true;
    } catch (e) {
        console.warn('‚ö†Ô∏è Supabase indisponible, sauvegarde locale:', e.message);
        _syncLocal();
        return false;
    }
}

// Exposer la config paiement dans localStorage (pour boutique.html)
function _exposerConfigPaiement() {
    try {
        if (!parametres.identifiant?.slug) return;
        const json = JSON.stringify({ ...parametres });
        localStorage.setItem('parametres_boutique', json);
    } catch (e) {
        console.error('‚ùå Erreur exposition config:', e);
    }
}

// ==================== IDENTIFIANT BOUTIQUE ====================
function genererIdentifiantAuto() {
    return `oda-${Date.now().toString(36)}-${Math.random().toString(36).substring(2, 6)}`;
}

async function initialiserIdentifiantUnique() {
    if (!parametres.identifiant?.slug) {
        const slug = genererIdentifiantAuto();
        parametres.identifiant = {
            slug,
            disponible: true,
            auto: true,
            dateCreation: new Date().toISOString()
        };
        parametres.slug = slug;
        await sauvegarderParametres();
        afficherNotification('üîñ Identifiant unique g√©n√©r√© automatiquement', 'success');
    }
    afficherIdentifiantActuel();
}

function afficherIdentifiantActuel() {
    const el    = document.getElementById('identifiantActuel');
    const actif = document.getElementById('identifiantActif');
    const lien  = document.getElementById('lienBoutique');
    const form  = document.getElementById('identifiantForm');

    if (parametres.identifiant?.slug) {
        if (el)    el.style.display = 'block';
        if (actif) actif.textContent = parametres.identifiant.slug;
        if (lien)  lien.value = `${window.location.origin}/boutique.html?shop=${parametres.identifiant.slug}`;
        if (form)  form.style.display = 'none';
    }
}

async function verifierDisponibiliteSlug(slug) {
    try {
        if (parametres.identifiant?.slug === slug) {
            _setSlugStatus('available', '‚úì C\'est votre identifiant actuel');
            return true;
        }
        const { data } = await supabase
            .from('parametres_boutique')
            .select('user_id')
            .eq('config->identifiant->>slug', slug)
            .neq('user_id', currentUser.id)
            .single();

        const dispo = !data;
        _setSlugStatus(dispo ? 'available' : 'unavailable',
                       dispo ? '‚úì Identifiant disponible' : '‚úó Identifiant d√©j√† utilis√©');
        return dispo;
    } catch (_) { return false; }
}

function _setSlugStatus(cls, txt) {
    const el = document.getElementById('slugAvailability');
    if (el) { el.className = `slug-status ${cls}`; el.textContent = txt; }
}

// ==================== NOTIFICATIONS UI ====================
function afficherNotification(message, type = 'info') {
    let conteneur = document.getElementById('notification-container');
    if (!conteneur) {
        conteneur = document.createElement('div');
        conteneur.id = 'notification-container';
        conteneur.style.cssText = 'position:fixed;top:100px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:12px';
        document.body.appendChild(conteneur);
    }
    const couleurs = { success: '#34C759', error: '#FF3B30', info: '#007AFF', warning: '#FF9500' };
    const notif = document.createElement('div');
    notif.style.cssText = `background:white;padding:16px 24px;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,0.15);border-left:4px solid ${couleurs[type]};animation:slideIn 0.5s ease;max-width:350px;font-family:'Poppins',sans-serif;font-weight:500;color:#1D1D1F`;
    notif.textContent = message;
    conteneur.appendChild(notif);
    setTimeout(() => {
        notif.style.animation = 'fadeOut 0.5s ease';
        setTimeout(() => notif.remove(), 500);
    }, 3000);
}

// ==================== APPLIQUER PARAM√àTRES AUX FORMULAIRES ====================
function appliquerParametres() {
    if (parametres.general) {
        const map = { shopName: 'nom', shopDescription: 'description', shopEmail: 'email', shopPhone: 'telephone', shopAddress: 'adresse' };
        Object.entries(map).forEach(([id, key]) => {
            const el = document.getElementById(id);
            if (el) el.value = parametres.general[key] || '';
        });
    }

    if (parametres.identifiant) {
        const slugInput   = document.getElementById('shopSlug');
        const slugPreview = document.getElementById('slugPreview');
        if (slugInput)   slugInput.value     = parametres.identifiant.slug || '';
        if (slugPreview) slugPreview.textContent = parametres.identifiant.slug || 'votre-identifiant';
    }

    if (parametres.paiement) {
        const map = { paymentCard: 'carte', paymentMobile: 'mobile', paymentCash: 'cash' };
        Object.entries(map).forEach(([id, key]) => {
            const el = document.getElementById(id);
            if (el) {
                el.checked = parametres.paiement[key].actif;
                if (el.checked) {
                    const details = document.getElementById(id === 'paymentCard' ? 'cardDetails' : id === 'paymentMobile' ? 'mobileDetails' : 'cashDetails');
                    if (details) details.style.display = 'block';
                }
            }
        });
        const currency = document.getElementById('currency');
        if (currency) currency.value = parametres.paiement.devise;
    }

    if (parametres.livraison) {
        const map = { fraisDouala: 'fraisDouala', fraisAutres: 'fraisAutres', delaiLivraison: 'delai', montantMinimum: 'montantMin' };
        Object.entries(map).forEach(([id, key]) => {
            const el = document.getElementById(id);
            if (el) el.value = parametres.livraison[key];
        });
        const fs = document.getElementById('freeShipping');
        if (fs) fs.checked = parametres.livraison.gratuit;
    }

    if (parametres.notifications) {
        const map = { notifOrders: 'commandes', notifStock: 'stock', notifClients: 'clients', notifReports: 'rapports' };
        Object.entries(map).forEach(([id, key]) => {
            const el = document.getElementById(id);
            if (el) el.checked = parametres.notifications[key];
        });
    }
}

// ==================== FONCTIONS GLOBALES ====================
window.afficherFormulaireModification = function() {
    const form = document.getElementById('identifiantForm');
    const slug = document.getElementById('shopSlug');
    if (form) form.style.display = 'block';
    if (parametres.identifiant?.slug && !parametres.identifiant.auto && slug) {
        slug.value = parametres.identifiant.slug;
    }
    if (form) form.scrollIntoView({ behavior: 'smooth', block: 'center' });
};

window.copierLienBoutique = function() {
    const input = document.getElementById('lienBoutique');
    if (input) {
        input.select();
        document.execCommand('copy');
        afficherNotification('‚úÖ Lien copi√© dans le presse-papiers !', 'success');
        input.style.background = 'rgba(52,199,89,0.1)';
        setTimeout(() => { input.style.background = 'white'; }, 500);
    }
};

window.getShopSettings = function() {
    return {
        nom: parametres.general.nom,
        description: parametres.general.description,
        email: parametres.general.email,
        telephone: parametres.general.telephone,
        adresse: parametres.general.adresse,
        slug: parametres.identifiant.slug,
        couleurPrimaire:   parametres.apparence.couleurPrimaire,
        couleurSecondaire: parametres.apparence.couleurSecondaire,
        logo:    parametres.apparence.logo,
        favicon: parametres.apparence.favicon,
        police:  parametres.apparence.police,
        paiement: {
            carte:   parametres.paiement.carte.actif,
            mobile:  parametres.paiement.mobile.actif,
            mtn:     parametres.paiement.mobile.mtn,
            orange:  parametres.paiement.mobile.orange,
            cash:    parametres.paiement.cash.actif,
            devise:  parametres.paiement.devise
        },
        livraison: parametres.livraison
    };
};

window.getZonesLivraison = function() {
    const zones = [
        { nom: 'Douala',       frais: parametres.livraison?.fraisDouala || 1000 },
        { nom: 'Autres villes', frais: parametres.livraison?.fraisAutres || 2500 }
    ];
    if (parametres.livraison?.zonesPersonnalisees) {
        zones.push(...parametres.livraison.zonesPersonnalisees);
    }
    return zones;
};

window.exporterDonnees = async function() {
    if (!confirm('Voulez-vous exporter toutes vos donn√©es ?')) return;
    try {
        const { data: produits }  = await supabase.from('produits').select('*').eq('user_id', currentUser.id);
        const { data: commandes } = await supabase.from('commandes').select('*').eq('user_id', currentUser.id);
        const donnees = { parametres, produits: produits || [], commandes: commandes || [], date: new Date().toISOString() };
        const blob = new Blob([JSON.stringify(donnees, null, 2)], { type: 'application/json' });
        const url  = URL.createObjectURL(blob);
        const a = Object.assign(document.createElement('a'), { href: url, download: `export_boutique_${new Date().toISOString().split('T')[0]}.json` });
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
        URL.revokeObjectURL(url);
        afficherNotification('üì• Donn√©es export√©es avec succ√®s', 'success');
    } catch (_) {
        afficherNotification('‚ùå Erreur lors de l\'export', 'error');
    }
};

window.supprimerCompte = async function() {
    const conf = prompt('‚ö†Ô∏è ATTENTION ! Cette action est irr√©versible.\n\nTapez "SUPPRIMER" pour confirmer :');
    if (conf !== 'SUPPRIMER') { afficherNotification('‚ùå Suppression annul√©e', 'info'); return; }
    try {
        afficherNotification('‚è≥ Suppression en cours...', 'info');
        await supabase.from('produits').delete().eq('user_id', currentUser.id);
        await supabase.from('commandes').delete().eq('user_id', currentUser.id);
        await supabase.from('parametres_boutique').delete().eq('user_id', currentUser.id);
        localStorage.clear(); sessionStorage.clear();
        afficherNotification('üóëÔ∏è Compte supprim√©. Redirection...', 'success');
        setTimeout(() => { window.location.href = 'index.html'; }, 2000);
    } catch (_) {
        afficherNotification('‚ùå Erreur lors de la suppression', 'error');
    }
};
// ==================== PARTIE 2/4 : NAVIGATION & MENUS ====================

function initialiserMenuHamburger() {
    const btn     = document.getElementById('hamburgerBtn');
    const menu    = document.getElementById('hamburgerMenu');
    const overlay = document.getElementById('hamburgerOverlay');
    const close   = document.getElementById('closeMenu');

    const fermer = () => {
        btn?.classList.remove('active');
        menu?.classList.remove('active');
        overlay?.classList.remove('active');
        document.body.style.overflow = '';
    };

    btn?.addEventListener('click', () => {
        const opening = !menu?.classList.contains('active');
        btn.classList.toggle('active');
        menu?.classList.toggle('active');
        overlay?.classList.toggle('active');
        document.body.style.overflow = opening ? 'hidden' : '';
    });

    close?.addEventListener('click', fermer);
    overlay?.addEventListener('click', fermer);
    document.querySelectorAll('.hamburger-link').forEach(l => l.addEventListener('click', () => setTimeout(fermer, 300)));
}

function initialiserNavigation() {
    document.querySelectorAll('.settings-menu-link').forEach(lien => {
        lien.addEventListener('click', (e) => {
            e.preventDefault();
            document.querySelectorAll('.settings-menu-link').forEach(l => l.classList.remove('active'));
            lien.classList.add('active');
            document.querySelectorAll('.settings-section').forEach(s => s.style.display = 'none');
            const section = document.getElementById(lien.getAttribute('data-section'));
            if (section) {
                section.style.display = 'block';
                if (window.innerWidth <= 768) window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    });
}

function naviguerVersSection(sectionId) {
    document.querySelectorAll('.settings-section').forEach(s => s.style.display = 'none');
    const section = document.getElementById(sectionId);
    if (section) {
        section.style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
        document.querySelectorAll('.settings-menu-link').forEach(l => {
            l.classList.toggle('active', l.getAttribute('data-section') === sectionId);
        });
    }
}

// ==================== MENU MOBILE ANDROID ====================
function creerMenuMobileAndroid() {
    if (window.innerWidth > 768) return;
    document.getElementById('menu-mobile-android')?.remove();

    const menuMobile = document.createElement('div');
    menuMobile.id = 'menu-mobile-android';

    const items = [
        { icon: 'üè™', label: 'G√©n√©ral',       section: 'general' },
        { icon: 'üîñ', label: 'Identifiant',   section: 'identifiant' },
        { icon: 'üí≥', label: 'Paiement',      section: 'payment' },
        { icon: 'üì¶', label: 'Livraison',     section: 'shipping' },
        { icon: 'üîî', label: 'Notifications', section: 'notifications' },
        { icon: 'üîí', label: 'S√©curit√©',      section: 'security' },
        { icon: 'üé®', label: 'Apparence',     section: 'apparence' }
    ];

    items.forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'menu-mobile-btn';
        btn.dataset.section = item.section;
        const sectionEl = document.getElementById(item.section);
        const isActive  = sectionEl && sectionEl.style.display !== 'none';
        if (isActive) btn.classList.add('active');

        const iconSpan  = document.createElement('span');
        iconSpan.className = 'link-icon';
        iconSpan.textContent = item.icon;

        const labelSpan = document.createElement('span');
        labelSpan.textContent = item.label;

        btn.appendChild(iconSpan);
        btn.appendChild(labelSpan);

        if (isActive) {
            const dot = document.createElement('div');
            dot.className = 'active-indicator';
            btn.appendChild(dot);
        }

        btn.addEventListener('click', () => {
            naviguerVersSection(item.section);
            mettreAJourMenuActif(btn);
        });

        menuMobile.appendChild(btn);
    });

    document.body.appendChild(menuMobile);
    document.body.style.paddingBottom = '85px';
}

function mettreAJourMenuActif(boutonActif) {
    document.querySelectorAll('.menu-mobile-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.querySelector('.active-indicator')?.remove();
    });
    boutonActif.classList.add('active');
    const dot = document.createElement('div');
    dot.className = 'active-indicator';
    boutonActif.appendChild(dot);

    const icon = boutonActif.querySelector('.link-icon');
    if (icon) {
        icon.style.transform = 'scale(1.2)';
        setTimeout(() => { icon.style.transform = 'scale(1)'; }, 200);
    }
    boutonActif.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
}

function initialiserMenuMobileAndroid() {
    if (window.innerWidth <= 768) creerMenuMobileAndroid();

    window.addEventListener('resize', () => {
        const menu = document.getElementById('menu-mobile-android');
        if (window.innerWidth > 768) {
            if (menu) { menu.style.display = 'none'; document.body.style.paddingBottom = '0'; }
        } else {
            if (menu) { menu.style.display = 'flex'; document.body.style.paddingBottom = '90px'; }
            else creerMenuMobileAndroid();
        }
    });

    document.querySelectorAll('.settings-menu-link').forEach(link => {
        link.addEventListener('click', () => {
            const section = link.getAttribute('data-section');
            if (section) {
                const btn = document.querySelector(`.menu-mobile-btn[data-section="${section}"]`);
                if (btn) mettreAJourMenuActif(btn);
            }
        });
    });
}

// ==================== BOUTON NOTIFICATIONS ====================
function ajouterBoutonNotifications() {
    const container = document.querySelector('.header-actions');
    if (!container || document.getElementById('btn-notifications')) return;

    const btn = document.createElement('button');
    btn.id = 'btn-notifications';
    btn.className = 'icon-btn';
    btn.innerHTML = 'üîî';
    btn.title = 'Activer les notifications';
    btn.style.cssText = 'position:relative;background:linear-gradient(135deg,#FFD700,#FFA500);color:white;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s ease;border:none;font-size:1.2rem';

    btn.addEventListener('click', async () => {
        if (!window.notificationManager) return;
        if (Notification.permission === 'default') {
            const granted = await window.notificationManager.requestPermission();
            if (granted) {
                btn.style.background = 'linear-gradient(135deg,#34C759,#4CAF50)';
                afficherNotification('‚úÖ Notifications activ√©es !', 'success');
            }
        } else if (Notification.permission === 'granted') {
            afficherNotification('‚úÖ Notifications d√©j√† activ√©es', 'success');
        } else {
            alert('‚ùå Notifications bloqu√©es. Autorisez-les dans les param√®tres du navigateur.');
        }
    });

    if (Notification.permission === 'granted') btn.style.background = 'linear-gradient(135deg,#34C759,#4CAF50)';
    else if (Notification.permission === 'denied') btn.style.background = 'linear-gradient(135deg,#FF3B30,#CC2F26)';

    container.appendChild(btn);
}
document.addEventListener('DOMContentLoaded', ajouterBoutonNotifications);

// ==================== FORMULAIRES G√âN√âRAUX ====================
function initialiserFormulaires() {
    // Formulaire g√©n√©ral
    document.getElementById('generalForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        parametres.general = {
            nom:         document.getElementById('shopName')?.value        || '',
            description: document.getElementById('shopDescription')?.value || '',
            email:       document.getElementById('shopEmail')?.value       || '',
            telephone:   document.getElementById('shopPhone')?.value       || '',
            adresse:     document.getElementById('shopAddress')?.value     || ''
        };
        const ok = await sauvegarderParametres();
        afficherNotification(ok ? '‚úÖ Param√®tres g√©n√©raux enregistr√©s' : '‚ö†Ô∏è Sauvegard√© localement', ok ? 'success' : 'warning');
    });

    // Formulaire livraison
    document.getElementById('shippingForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        sauvegarderZonesLivraison();
        parametres.livraison = {
            fraisDouala:      parseInt(document.getElementById('fraisDouala')?.value)  || 0,
            fraisAutres:      parseInt(document.getElementById('fraisAutres')?.value)  || 0,
            delai:            document.getElementById('delaiLivraison')?.value         || '',
            livraisonGratuite: document.getElementById('freeShipping')?.checked        || false,
            montantMinimum:   parseInt(document.getElementById('montantMinimum')?.value) || 0,
            zonesPersonnalisees: parametres.livraison.zonesPersonnalisees || []
        };
        const ok = await sauvegarderParametres();
        afficherNotification(ok ? 'üì¶ Options de livraison sauvegard√©es' : '‚ö†Ô∏è Sauvegard√© localement', ok ? 'success' : 'warning');
    });

    // Formulaire s√©curit√©
    document.getElementById('securityForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const current = document.getElementById('currentPassword')?.value;
        const nouveau = document.getElementById('newPassword')?.value;
        const confirm = document.getElementById('confirmPassword')?.value;

        if (!current || !nouveau || !confirm) { afficherNotification('‚ö†Ô∏è Veuillez remplir tous les champs', 'warning'); return; }
        if (nouveau !== confirm)              { afficherNotification('‚ùå Les mots de passe ne correspondent pas', 'error'); return; }
        if (nouveau.length < 8)              { afficherNotification('‚ö†Ô∏è Mot de passe trop court (min 8 caract√®res)', 'warning'); return; }

        try {
            const { error } = await supabase.auth.updateUser({ password: nouveau });
            if (error) throw error;
            document.getElementById('securityForm').reset();
            afficherNotification('üîí Mot de passe modifi√© avec succ√®s', 'success');
        } catch (_) {
            afficherNotification('‚ùå Erreur lors du changement de mot de passe', 'error');
        }
    });

    // Notifications
    [
        { id: 'notifOrders',  key: 'commandes' },
        { id: 'notifStock',   key: 'stock' },
        { id: 'notifClients', key: 'clients' },
        { id: 'notifReports', key: 'rapports' }
    ].forEach(({ id, key }) => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('change', async () => {
            parametres.notifications[key] = el.checked;
            await sauvegarderParametres();
            afficherNotification('üîî Pr√©f√©rences de notifications mises √† jour', 'info');
        });
    });

    // Devise
    document.getElementById('currency')?.addEventListener('change', async (e) => {
        parametres.paiement.devise = e.target.value;
        await sauvegarderParametres();
        afficherNotification('üí± Devise mise √† jour', 'info');
    });
}

// ==================== IDENTIFIANT ====================
function initialiserIdentifiant() {
    const slugInput   = document.getElementById('shopSlug');
    const slugPreview = document.getElementById('slugPreview');
    const urlBase     = document.getElementById('urlBase');
    let timeout;

    if (urlBase) urlBase.textContent = `${window.location.origin}/boutique.html`;

    slugInput?.addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, '').replace(/--+/g, '-').substring(0, 50);
        e.target.value = val;
        if (slugPreview) slugPreview.textContent = val || 'votre-identifiant';
        clearTimeout(timeout);
        if (val.length >= 3) timeout = setTimeout(() => verifierDisponibiliteSlug(val), 500);
        else _setSlugStatus('', '');
    });

    document.getElementById('identifiantForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const slug = slugInput?.value.trim();
        if (!slug)         { afficherNotification('‚ö†Ô∏è Veuillez entrer un identifiant', 'warning'); return; }
        if (slug.length < 3) { afficherNotification('‚ö†Ô∏è L\'identifiant doit contenir au moins 3 caract√®res', 'warning'); return; }

        const dispo = await verifierDisponibiliteSlug(slug);
        if (!dispo && parametres.identifiant?.slug !== slug) {
            afficherNotification('‚ùå Cet identifiant est d√©j√† utilis√©', 'error');
            return;
        }

        parametres.identifiant = {
            slug,
            disponible: true,
            auto: false,
            dateCreation:     parametres.identifiant?.dateCreation || new Date().toISOString(),
            dateModification: new Date().toISOString()
        };
        parametres.slug = slug;

        const ok = await sauvegarderParametres();
        if (ok) {
            afficherNotification('üîñ Identifiant unique enregistr√© avec succ√®s', 'success');
            afficherIdentifiantActuel();
        } else {
            afficherNotification('‚ö†Ô∏è Sauvegard√© localement uniquement', 'warning');
        }
    });
}
// ==================== PARTIE 3/4 : PAIEMENT, LIVRAISON & MOBILE MONEY ====================

// ==================== PAIEMENT ====================
function initialiserPaiement() {
    _initTogglePaiement('paymentCard',   'cardDetails',   'carte');
    _initTogglePaiement('paymentMobile', 'mobileDetails', 'mobile');
    _initTogglePaiement('paymentCash',   'cashDetails',   'cash');
}

function _initTogglePaiement(checkboxId, detailsId, key) {
    const cb      = document.getElementById(checkboxId);
    const details = document.getElementById(detailsId);
    if (!cb) return;

    cb.addEventListener('change', async () => {
        if (details) details.style.display = cb.checked ? 'block' : 'none';
        parametres.paiement[key].actif = cb.checked;
        await sauvegarderParametres();
    });

    if (cb.checked && details) details.style.display = 'block';
}

window.confirmerPaiement = async function(type) {
    if (type === 'card') {
        const cle = document.getElementById('stripeKey')?.value;
        if (!cle) { afficherNotification('‚ö†Ô∏è Veuillez entrer votre cl√© API Stripe', 'warning'); return; }
        parametres.paiement.carte.cle      = cle;
        parametres.paiement.carte.confirme = true;
    } else if (type === 'cash') {
        parametres.paiement.cash.confirme = true;
    }
    const ok = await sauvegarderParametres();
    afficherNotification(ok
        ? `‚úÖ ${type === 'card' ? 'Carte bancaire' : 'Paiement √† la livraison'} configur√©`
        : '‚ö†Ô∏è Sauvegard√© localement',
        ok ? 'success' : 'warning');
};

// ==================== MOBILE MONEY ====================
function initialiserMobileMoney() {
    const paymentMobile = document.getElementById('paymentMobile');
    const mobileDetails = document.getElementById('mobileDetails');

    // √âviter double-listener avec initialiserPaiement ‚Äî on √©coute juste l'affichage ici
    if (paymentMobile?.checked && mobileDetails) mobileDetails.style.display = 'block';

    // MTN
    const mtnActive = document.getElementById('mtnActive');
    const mtnInputs = document.getElementById('mtnInputs');
    if (mtnActive) {
        mtnActive.addEventListener('change', async () => {
            if (mtnInputs) mtnInputs.style.display = mtnActive.checked ? 'block' : 'none';
            parametres.paiement.mobile.mtn.actif = mtnActive.checked;
            await sauvegarderParametres();
            afficherNotification(mtnActive.checked ? '‚úÖ MTN Money activ√©' : '‚ùå MTN Money d√©sactiv√©', 'info');
        });
        if (parametres.paiement.mobile.mtn) {
            mtnActive.checked = parametres.paiement.mobile.mtn.actif || false;
            if (mtnActive.checked && mtnInputs) mtnInputs.style.display = 'block';
            const nom = document.getElementById('mtnNomCompte');
            const num = document.getElementById('mtnNumero');
            if (nom) nom.value = parametres.paiement.mobile.mtn.nomCompte || '';
            if (num) num.value = parametres.paiement.mobile.mtn.numero    || '';
        }
    }

    // Orange
    const orangeActive = document.getElementById('orangeActive');
    const orangeInputs = document.getElementById('orangeInputs');
    if (orangeActive) {
        orangeActive.addEventListener('change', async () => {
            if (orangeInputs) orangeInputs.style.display = orangeActive.checked ? 'block' : 'none';
            parametres.paiement.mobile.orange.actif = orangeActive.checked;
            await sauvegarderParametres();
            afficherNotification(orangeActive.checked ? '‚úÖ Orange Money activ√©' : '‚ùå Orange Money d√©sactiv√©', 'info');
        });
        if (parametres.paiement.mobile.orange) {
            orangeActive.checked = parametres.paiement.mobile.orange.actif || false;
            if (orangeActive.checked && orangeInputs) orangeInputs.style.display = 'block';
            const nom = document.getElementById('orangeNomCompte');
            const num = document.getElementById('orangeNumero');
            if (nom) nom.value = parametres.paiement.mobile.orange.nomCompte || '';
            if (num) num.value = parametres.paiement.mobile.orange.numero    || '';
        }
    }

    // Bouton Confirmer Mobile Money
    document.getElementById('confirmerMobileMoney')?.addEventListener('click', async () => {
        const mtnOn    = document.getElementById('mtnActive')?.checked;
        const orangeOn = document.getElementById('orangeActive')?.checked;

        if (!mtnOn && !orangeOn) {
            afficherNotification('‚ö†Ô∏è Veuillez activer au moins MTN Money ou Orange Money', 'warning');
            return;
        }

        const erreurs = [];
        const RE_TEL  = /^\+237[67]\d{8}$/;

        if (mtnOn) {
            const nom = document.getElementById('mtnNomCompte')?.value.trim();
            const num = document.getElementById('mtnNumero')?.value.replace(/\s/g, '');
            if (!nom) erreurs.push('Nom du compte MTN Money manquant');
            if (!num) erreurs.push('Num√©ro MTN Money manquant');
            else if (!RE_TEL.test(num)) erreurs.push('Format num√©ro MTN Money invalide (+237XXXXXXXXX)');
            if (erreurs.length === 0) {
                parametres.paiement.mobile.mtn = { actif: true, nomCompte: nom, numero: num, confirme: true };
            }
        } else {
            parametres.paiement.mobile.mtn = { ...parametres.paiement.mobile.mtn, actif: false };
        }

        if (orangeOn) {
            const nom = document.getElementById('orangeNomCompte')?.value.trim();
            const num = document.getElementById('orangeNumero')?.value.replace(/\s/g, '');
            if (!nom) erreurs.push('Nom du compte Orange Money manquant');
            if (!num) erreurs.push('Num√©ro Orange Money manquant');
            else if (!RE_TEL.test(num)) erreurs.push('Format num√©ro Orange Money invalide (+237XXXXXXXXX)');
            if (erreurs.filter(e => e.includes('Orange')).length === 0) {
                parametres.paiement.mobile.orange = { actif: true, nomCompte: nom, numero: num, confirme: true };
            }
        } else {
            parametres.paiement.mobile.orange = { ...parametres.paiement.mobile.orange, actif: false };
        }

        if (erreurs.length > 0) {
            erreurs.forEach(err => afficherNotification(`‚ùå ${err}`, 'error'));
            return;
        }

        parametres.paiement.mobile.confirme = true;
        const ok = await sauvegarderParametres();
        afficherNotification(ok ? '‚úÖ Mobile Money configur√© avec succ√®s !' : '‚ö†Ô∏è Sauvegard√© localement', ok ? 'success' : 'warning');
    });
}

// ==================== ZONES DE LIVRAISON ====================
function initialiserZonesLivraison() {
    document.getElementById('ajouterZone')?.addEventListener('click', () => ajouterZoneLivraison());

    if (parametres.livraison.zonesPersonnalisees?.length > 0) {
        parametres.livraison.zonesPersonnalisees.forEach(zone => ajouterZoneLivraison(zone));
        const empty = document.getElementById('emptyZonesMessage');
        if (empty) empty.style.display = 'none';
    }
}

function ajouterZoneLivraison(zoneExistante = null) {
    const container = document.getElementById('zonesContainer');
    if (!container) return;

    const zoneId  = Date.now();
    const zoneCard = document.createElement('div');
    zoneCard.className      = 'zone-card';
    zoneCard.dataset.zoneId = zoneId;
    zoneCard.style.cssText  = 'background:var(--bg-primary);padding:16px;border-radius:12px;margin-bottom:12px;opacity:0;transform:translateY(10px);transition:all 0.3s ease';

    zoneCard.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <span style="font-weight:600">üìç Zone ${container.children.length + 1}</span>
            <button type="button" onclick="supprimerZone(${zoneId})" style="padding:6px 12px;background:var(--danger-color);color:white;border:none;border-radius:6px;cursor:pointer;font-size:0.85rem">üóëÔ∏è Supprimer</button>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div>
                <label style="font-size:0.85rem">Nom du lieu</label>
                <input type="text" class="form-input zone-nom" placeholder="Ex: Yaound√©" value="${zoneExistante?.nom || ''}" style="font-size:0.9rem">
            </div>
            <div>
                <label style="font-size:0.85rem">Frais (FCFA)</label>
                <input type="number" class="form-input zone-frais" placeholder="0" value="${zoneExistante?.frais || ''}" min="0" style="font-size:0.9rem">
            </div>
        </div>
    `;

    container.appendChild(zoneCard);
    document.getElementById('emptyZonesMessage')?.style.setProperty('display', 'none');

    setTimeout(() => { zoneCard.style.opacity = '1'; zoneCard.style.transform = 'translateY(0)'; }, 10);
    zoneCard.querySelectorAll('input').forEach(inp => inp.addEventListener('change', sauvegarderZonesLivraison));
}

window.supprimerZone = function(zoneId) {
    if (!confirm('Voulez-vous vraiment supprimer cette zone de livraison ?')) return;
    const card = document.querySelector(`[data-zone-id="${zoneId}"]`);
    if (!card) return;
    card.style.animation = 'fadeOut 0.3s ease';
    setTimeout(() => {
        card.remove();
        sauvegarderZonesLivraison();
        const container = document.getElementById('zonesContainer');
        const empty     = document.getElementById('emptyZonesMessage');
        if (container?.children.length === 0 && empty) empty.style.display = 'block';
    }, 300);
};

function sauvegarderZonesLivraison() {
    const zones = [];
    document.querySelectorAll('.zone-card').forEach(card => {
        const nom   = card.querySelector('.zone-nom')?.value.trim();
        const frais = parseInt(card.querySelector('.zone-frais')?.value) || 0;
        if (nom) zones.push({ nom, frais });
    });
    parametres.livraison.zonesPersonnalisees = zones;
}
// ==================== PARTIE 4/4 : APPARENCE & INITIALISATION ====================

// ==================== APPARENCE ====================
function initialiserApparence() {

// --- Couleur Primaire ---
const primaryInput   = document.getElementById('primaryColor');
const primaryHex     = document.getElementById('primaryColorHex');
const primaryPreview = document.getElementById('primaryColorPreview');

primaryInput?.addEventListener('input', (e) => {
    const c = e.target.value;
    parametres.apparence.couleurPrimaire = c;
    if (primaryPreview) primaryPreview.style.background = c;
    if (primaryHex)     primaryHex.value = c.toUpperCase();
    document.documentElement.style.setProperty('--primary-color', c);
});

// --- Couleur Secondaire ---
const secondaryInput   = document.getElementById('secondaryColor');
const secondaryHex     = document.getElementById('secondaryColorHex');
const secondaryPreview = document.getElementById('secondaryColorPreview');

secondaryInput?.addEventListener('input', (e) => {
    const c = e.target.value;
    parametres.apparence.couleurSecondaire = c;
    if (secondaryPreview) secondaryPreview.style.background = c;
    if (secondaryHex)     secondaryHex.value = c.toUpperCase();
    document.documentElement.style.setProperty('--secondary-color', c);
});

// --- TYPOGRAPHIE ---
const POLICES = [
    'Inter','Poppins','Nunito','DM Sans','Plus Jakarta Sans','Outfit',
    'Montserrat','Raleway','Josefin Sans','Lato','Open Sans','Roboto',
    'Playfair Display','Cormorant Garamond','Libre Baskerville','DM Serif Display',
    'Pacifico','Righteous','Bebas Neue','Abril Fatface'
];

// Pr√©charger toutes les polices pour les cartes d'aper√ßu
POLICES.forEach(p => {
    const id = 'gf-' + p.replace(/\s/g, '-');
    if (!document.getElementById(id)) {
        const link = document.createElement('link');
        link.id   = id;
        link.rel  = 'stylesheet';
        link.href = `https://fonts.googleapis.com/css2?family=${encodeURIComponent(p)}:wght@300;400;500;600;700;800&display=swap`;
        document.head.appendChild(link);
    }
});

// appliquerPolice : uniquement sur les √©l√©ments preview ‚Äî PAS sur document.body
// La police s'appliquera sur boutique.html via appliquerTheme() au chargement
function appliquerPolice(police) {
    parametres.apparence.police = police;
    const ids = [
        'fontPreviewTitle','fontPreviewSubtitle','fontPreviewText',
        'fontPreviewBadge','fontPreviewPrice','fontPreviewName'
    ];
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.fontFamily = `'${police}', sans-serif`;
    });
    const nameEl = document.getElementById('fontPreviewName');
    if (nameEl) nameEl.textContent = `Police actuelle : ${police}`;
}

function genererCartesPolice(policeActive) {
    const container = document.getElementById('fontPreviewCards');
    if (!container) return;
    container.innerHTML = '';

    const exemples = [
        { police: 'Inter',              texte: 'Aa ‚Äî The quick brown fox',  style: 'normal' },
        { police: 'Playfair Display',   texte: 'Aa ‚Äî La Boutique √âl√©gante', style: 'italic' },
        { police: 'Pacifico',           texte: 'Aa ‚Äî Bienvenue chez nous',  style: 'normal' },
        { police: 'Bebas Neue',         texte: 'AA ‚Äî COLLECTION 2025',      style: 'normal' },
        { police: 'Poppins',            texte: 'Aa ‚Äî Style & √âl√©gance',     style: 'normal' },
        { police: 'Cormorant Garamond', texte: 'Aa ‚Äî Haute Couture',        style: 'italic' },
    ];

    exemples.forEach(({ police, texte, style }) => {
        const isActive = policeActive === police;
        const card = document.createElement('div');
        card.style.cssText = `
            padding:14px 16px;border-radius:10px;cursor:pointer;transition:all 0.2s ease;
            border:2px solid ${isActive ? 'var(--primary-color)' : 'var(--border-color)'};
            background:${isActive ? 'rgba(0,122,255,0.05)' : '#fff'};
        `;
        card.innerHTML = `
            <p style="font-family:'${police}',serif;font-size:1rem;font-style:${style};margin-bottom:4px;color:var(--text-primary)">${texte}</p>
            <small style="font-size:0.75rem;color:var(--text-secondary);font-family:'Poppins',sans-serif">${police}</small>
        `;
        card.addEventListener('click', () => {
            const sel = document.getElementById('fontFamily');
            if (sel) sel.value = police;
            appliquerPolice(police);
            genererCartesPolice(police);
        });
        container.appendChild(card);
    });
}

// Init police sauvegard√©e
const fontSelect = document.getElementById('fontFamily');
if (fontSelect) {
    const saved = parametres.apparence?.police || 'Inter';
    fontSelect.value = saved;
    appliquerPolice(saved);
    genererCartesPolice(saved);
    fontSelect.addEventListener('change', (e) => {
        appliquerPolice(e.target.value);
        genererCartesPolice(e.target.value);
    });
}

// --- BOUTON SAUVEGARDER avec effet visuel ---
const saveBtn = document.getElementById('saveAppearance');
if (saveBtn) {
    saveBtn.addEventListener('click', async () => {
        const originalHTML = saveBtn.innerHTML;
        saveBtn.disabled   = true;
        saveBtn.innerHTML  = `
            <span style="display:inline-flex;align-items:center;gap:8px">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                     style="animation:spin 0.8s linear infinite;flex-shrink:0">
                    <path d="M12 2a10 10 0 1 0 10 10" stroke-linecap="round"/>
                </svg>
                Sauvegarde en cours...
            </span>`;

        const ok = await sauvegarderParametres();

        saveBtn.innerHTML         = ok
            ? `<span style="display:inline-flex;align-items:center;gap:6px">‚úÖ Sauvegard√© !</span>`
            : `<span style="display:inline-flex;align-items:center;gap:6px">‚ö†Ô∏è Sauvegard√© localement</span>`;
        saveBtn.style.background  = ok ? '#34C759' : '#FF9500';
        saveBtn.style.borderColor = ok ? '#34C759' : '#FF9500';
        saveBtn.style.transform   = 'scale(1.03)';

        setTimeout(() => {
            saveBtn.innerHTML         = originalHTML;
            saveBtn.style.background  = '';
            saveBtn.style.borderColor = '';
            saveBtn.style.transform   = '';
            saveBtn.disabled          = false;
        }, 2200);

        afficherNotification(
            ok ? '‚úÖ Apparence sauvegard√©e ‚Äî boutique.html mise √† jour !' : '‚ö†Ô∏è Sauvegard√© localement uniquement',
            ok ? 'success' : 'warning'
        );
    });
}

// --- BOUTON R√âINITIALISER ---
document.getElementById('resetAppearance')?.addEventListener('click', async () => {
    if (!confirm('Voulez-vous vraiment r√©initialiser l\'apparence par d√©faut ?')) return;
    parametres.apparence = {
        couleurPrimaire:   '#FF6B00',
        couleurSecondaire: '#1A1A1A',
        logo:    '',
        favicon: '',
        police:  'Inter'
    };
    appliquerParametres();
    if (fontSelect) {
        fontSelect.value = 'Inter';
        appliquerPolice('Inter');
        genererCartesPolice('Inter');
    }
    await sauvegarderParametres();
    afficherNotification('‚úÖ Apparence r√©initialis√©e', 'success');
});

// --- UPLOAD LOGO ---
document.getElementById('logoUpload')?.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (file) await traiterImageUpload(file, 'logo');
});

// --- UPLOAD FAVICON ---
document.getElementById('faviconUpload')?.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (file) await traiterImageUpload(file, 'favicon');
});

// ==================== BOUTON PR√âVISUALISER SUR LA BOUTIQUE ====================
const previewBtn    = document.getElementById('previewEcommerce');
const previewModal  = document.getElementById('previewModal');
const previewClose  = document.getElementById('previewModalClose');
const previewFrame  = document.getElementById('previewIframe');
const previewUrlEl  = document.getElementById('previewModalUrl');
const previewOpen   = document.getElementById('previewOpenBtn');
const previewReload = document.getElementById('previewReloadBtn');


    const getBoutiqueUrl = () => {
        // Priorit√© 1 : l'input #lienBoutique (d√©j√† construit et fiable)
        const lienInput = document.getElementById('lienBoutique');
        if (lienInput?.value?.trim()) return lienInput.value.trim();

        // Priorit√© 2 : reconstruire depuis le slug en m√©moire
        const slug = parametres.identifiant?.slug;
        const base = `${window.location.origin}/boutique.html`;
        if (slug) return `${base}?shop=${slug}`;

  
        return base;
    };


const syncAvantPreview = () => {
    localStorage.setItem('parametres_boutique', JSON.stringify(parametres));
    if (parametres.identifiant?.slug) {
        localStorage.removeItem(`boutique_cache_${parametres.identifiant.slug}`);
    }
};

const ouvrirPreview = () => {
    syncAvantPreview();
    const url = getBoutiqueUrl();
    if (previewFrame)  previewFrame.src        = url;
    if (previewUrlEl)  previewUrlEl.textContent = url;
    if (previewOpen)   previewOpen.href         = url;
    previewModal?.classList.add('active');
    document.body.style.overflow = 'hidden';
};

const fermerPreview = () => {
    previewModal?.classList.remove('active');
    document.body.style.overflow = '';
    // Vider l'iframe apr√®s l'animation pour lib√©rer les ressources
    setTimeout(() => { if (previewFrame) previewFrame.src = ''; }, 300);
};

previewBtn?.addEventListener('click', ouvrirPreview);
previewClose?.addEventListener('click', fermerPreview);

// Clic sur le fond sombre pour fermer
previewModal?.addEventListener('click', (e) => {
    if (e.target === previewModal) fermerPreview();
});

// Touche √âchap pour fermer
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && previewModal?.classList.contains('active')) fermerPreview();
});

// Recharger l'iframe avec les toutes derni√®res modifications non encore sauvegard√©es
previewReload?.addEventListener('click', () => {
    syncAvantPreview();
    if (previewFrame) previewFrame.src = getBoutiqueUrl();
});
}

// ==================== PALETTE DE COULEURS ====================
window.appliquerPalette = function(couleurPrimaire, couleurSecondaire) {
const setColor = (inputId, hexId, previewId, valeur, key) => {
    const input   = document.getElementById(inputId);
    const hex     = document.getElementById(hexId);
    const preview = document.getElementById(previewId);
    if (input)   { input.value = valeur; parametres.apparence[key] = valeur; }
    if (hex)     hex.value = valeur.toUpperCase();
    if (preview) preview.style.background = valeur;
    document.documentElement.style.setProperty(
        `--${key === 'couleurPrimaire' ? 'primary' : 'secondary'}-color`, valeur
    );
};
setColor('primaryColor',   'primaryColorHex',   'primaryColorPreview',   couleurPrimaire,   'couleurPrimaire');
setColor('secondaryColor', 'secondaryColorHex', 'secondaryColorPreview', couleurSecondaire, 'couleurSecondaire');
afficherNotification('üé® Palette appliqu√©e !', 'success');
};

// ==================== UPLOAD IMAGES ====================
async function traiterImageUpload(file, type) {
if (file.size > 2 * 1024 * 1024) {
    afficherNotification('‚ùå Fichier trop volumineux (max 2MB)', 'error');
    return;
}
if (!file.type.startsWith('image/')) {
    afficherNotification('‚ùå Le fichier doit √™tre une image', 'error');
    return;
}

try {
    const reader = new FileReader();
    reader.onload = async (e) => {
        const b64 = e.target.result;

        if (type === 'logo') {
            parametres.apparence.logo = b64;
            const prev = document.getElementById('logoPreview');
            if (prev) prev.innerHTML = `<img src="${b64}" alt="Logo" style="max-width:200px;max-height:100px;object-fit:contain">`;
            afficherNotification('‚úÖ Logo charg√©', 'success');

        } else if (type === 'favicon') {
            parametres.apparence.favicon = b64;
            const prev = document.getElementById('faviconPreview');
            if (prev) prev.innerHTML = `<img src="${b64}" alt="Favicon" style="width:32px;height:32px;object-fit:contain">`;
            let link = document.querySelector("link[rel*='icon']");
            if (!link) {
                link = document.createElement('link');
                link.rel = 'icon';
                document.head.appendChild(link);
            }
            link.href = b64;
            afficherNotification('‚úÖ Favicon charg√©', 'success');
        }

        await sauvegarderParametres();
    };
    reader.readAsDataURL(file);
} catch (e) {
    console.error('Erreur upload:', e);
    afficherNotification('‚ùå Erreur lors du chargement de l\'image', 'error');
}
}

// ==================== INITIALISATION PRINCIPALE ====================
document.addEventListener('DOMContentLoaded', async () => {
console.log('‚öôÔ∏è Initialisation Param√®tres...');

await verifierAuthentification();
initialiserMenuHamburger();
await chargerParametres();
initialiserNavigation();
initialiserFormulaires();
initialiserIdentifiant();
initialiserPaiement();
initialiserApparence();
initialiserZonesLivraison();
initialiserMobileMoney();
initialiserMenuMobileAndroid();

// Afficher la premi√®re section par d√©faut
const first = document.querySelector('.settings-section');
if (first) first.style.display = 'block';

console.log('%c‚öôÔ∏è Param√®tres pr√™ts', 'color:#007AFF;font-size:16px;font-weight:bold');
console.log('%c‚úÖ Toutes les fonctionnalit√©s charg√©es', 'color:#34C759;font-size:13px');
});
 </script>
   <!-- ==================== MODAL PREVIEW BOUTIQUE ==================== -->
<div id="previewModal">
    <div class="preview-modal-box">
        <!-- Barre type navigateur -->
        <div class="preview-modal-bar">
            <div class="preview-modal-dots">
                <span></span><span></span><span></span>
            </div>
            <div class="preview-modal-url" id="previewModalUrl">boutique.html</div>
            <button class="preview-modal-close" id="previewModalClose" title="Fermer">‚úï</button>
        </div>

        <!-- iFrame boutique -->
        <iframe class="preview-modal-iframe" id="previewIframe" src="" title="Aper√ßu boutique"></iframe>

        <!-- Footer actions -->
        <div class="preview-modal-footer">
            <button class="preview-reload-btn" id="previewReloadBtn">
                üîÑ Recharger
            </button>
            <a class="preview-open-btn" id="previewOpenBtn" href="#" target="_blank">
                üîó Ouvrir dans un onglet
            </a>
        </div>
    </div>
</div> 
</body>
</html>
